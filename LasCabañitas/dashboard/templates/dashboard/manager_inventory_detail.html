{% extends "core/base.html" %}
{% block content %}
<div class="dashboard-container">
  
<h1>Inventario de {{ supply.cabin.name }}</h1>
<form method="post">
  {% csrf_token %}
  <table> 
    <thead>
      <tr>
        <th>Insumo</th>
        <th>Cantidad base</th>
        <th>Editar cantidad</th>
      </tr>
    </thead>
    <tbody>
      {% for item in supply_items %}
        <tr>
          <td>{{ item.item.name }}</td>
          <td>{{ item.base_quantity }}</td>
          <td>
            <input type="number" 
                   name="quantity_{{ item.id }}" 
                   value="{{ item.quantity }}" 
                   min="0" 
                   max="{{ item.base_quantity }}" 
                   required>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  
  <script>
    // Script de validación
    document.querySelectorAll('input[type="number"][name^="quantity_"]').forEach(function(input) {
      input.addEventListener('input', function() {
        const value = parseInt(input.value);
        const min = parseInt(input.getAttribute('min'));
        const max = parseInt(input.getAttribute('max'));
        if (isNaN(value)) {
          input.setCustomValidity('El valor no es válido.');
        } else if (value < min) {
          input.setCustomValidity('No se aceptan números negativos.');
        } else if (value > max) {
          input.setCustomValidity('No puede superar la cantidad base (' + max + ').');
        } else {
          input.setCustomValidity('');
        }
      });
    });
  </script>
  
  {% if errors %}
    <div style="color: var(--danger-color); margin-top: 15px; margin-bottom: 5px; padding: 10px; border: 1px solid var(--danger-color); border-radius: 4px;">
      <strong>Errores de validación:</strong>
      <ul>
        {% for error in errors %}
          <li>{{ error }}</li>
        {% endfor %}
      </ul>
    </div>
  {% endif %}
  
  <div style="margin-top: 20px;">
    <button type="submit" name="finalize_inventory" value="1" class="primary-button">Finalizar inventario</button>
  </div>
</form>

<div style="margin-top: 15px;">
  <a href="{% url 'manager_dashboard' %}" class="button-link primary-button">Volver al panel</a>
</div>
</div>
{% endblock %}